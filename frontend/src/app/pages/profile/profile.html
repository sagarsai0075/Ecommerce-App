<div class="profile-container">
  <div class="profile-wrapper">
    <!-- Navigation Tabs -->
    <div class="profile-nav" *ngIf="user">
      <button
        (click)="setActiveSection('personal-info')"
        [class.active]="activeSection === 'personal-info'"
        class="nav-btn">
        <i class="bi bi-person"></i>
        My Profile
      </button>
      <button
        (click)="setActiveSection('orders')"
        [class.active]="activeSection === 'orders'"
        class="nav-btn">
        <i class="bi bi-bag"></i>
        Orders
      </button>
      <button
        (click)="setActiveSection('change-password')"
        [class.active]="activeSection === 'change-password'"
        class="nav-btn">
        <i class="bi bi-geo-alt"></i>
        Saved Address
      </button>
    </div>

    <!-- Content Sections -->
    <div class="profile-content">
      <ng-container *ngIf="user; else profileState">
        <!-- Personal Info Section -->
        <div class="section" *ngIf="activeSection === 'personal-info'">
          <h2>Personal Info</h2>

          <div class="info-display personal-info-display">
            <div class="info-item">
              <label>Name</label>
              <p class="info-value">{{ user.name }}</p>
            </div>
            <div class="info-item">
              <label>Email</label>
              <p class="info-value">{{ user.email }}</p>
            </div>
            <div class="info-item">
              <label>Phone Number</label>
              <p class="info-value">{{ user.number }}</p>
            </div>
          </div>
        </div>

        <!-- Orders Section -->
        <div class="section" *ngIf="activeSection === 'orders'">
          <h2>Your Orders</h2>
          <div class="empty-state">
            <i class="bi bi-inbox"></i>
            <p>No orders yet. Start shopping!</p>
            <a href="/products" class="btn-primary">Continue Shopping</a>
          </div>
        </div>

        <!-- Saved Address Section -->
        <div class="section" *ngIf="activeSection === 'change-password'">
          <div class="section-header">
            <h2>Saved Address</h2>
            <button
              type="button"
              class="edit-text-link"
              (click)="toggleAddressEditMode()">
              <i *ngIf="!addressEditMode" class="bi bi-plus-circle"></i>
              {{ addressEditMode ? 'Cancel' : 'Add Address' }}
            </button>
          </div>

          <div *ngIf="!addressEditMode && hasSavedAddress()" class="saved-address-list">
            <div class="saved-details-preview" *ngFor="let savedAddress of getSavedAddresses(); let i = index">
              <label>{{ getAddressTitle(savedAddress) }}</label>
              <p>{{ user.name || '' }}</p>
              <p>{{ user.number || '' }}</p>
              <p>
                {{ savedAddress.houseNo || '' }}
                {{ savedAddress.address || '' }}
              </p>
              <p>
                {{ savedAddress.landmark || '' }}
                {{ savedAddress.district || '' }}
                {{ savedAddress.state || '' }}
                {{ savedAddress.pincode || '' }}
              </p>
              <div class="saved-details-actions">
                <button type="button" class="edit-text-link" (click)="editAddress(i)">
                  Edit
                </button>
                <button type="button" class="edit-text-link danger-link" (click)="deleteAddress(i)">
                  Delete
                </button>
              </div>
            </div>
          </div>

          <div *ngIf="!addressEditMode && !hasSavedAddress()" class="saved-details-preview empty-address">
            <label>Saved Address</label>
            <p>No saved addresses yet.</p>
          </div>

          <div *ngIf="addressEditMode" class="edit-form">
            <div class="form-group">
              <label for="houseNo">House Number</label>
              <input
                type="text"
                id="houseNo"
                [(ngModel)]="editedAddress.houseNo"
                class="form-input">
            </div>

            <div class="form-group">
              <label for="address">Address</label>
              <input
                type="text"
                id="address"
                [(ngModel)]="editedAddress.address"
                class="form-input">
            </div>

            <div class="form-group">
              <label for="landmark">Landmark</label>
              <input
                type="text"
                id="landmark"
                [(ngModel)]="editedAddress.landmark"
                class="form-input">
            </div>

            <div class="form-group">
              <label for="district">District</label>
              <input
                type="text"
                id="district"
                [(ngModel)]="editedAddress.district"
                class="form-input">
            </div>

            <div class="form-group">
              <label for="state">State</label>
              <input
                type="text"
                id="state"
                [(ngModel)]="editedAddress.state"
                class="form-input">
            </div>

            <div class="form-group">
              <label for="pincode">Pincode</label>
              <input
                type="text"
                id="pincode"
                [(ngModel)]="editedAddress.pincode"
                class="form-input">
            </div>

            <div class="form-group">
              <label for="addressType">Address Type</label>
              <select
                id="addressType"
                [(ngModel)]="editedAddress.addressType"
                class="form-input">
                <option value="Home">Home</option>
                <option value="Work">Work</option>
                <option value="Others">Others</option>
              </select>
            </div>

            <div class="form-group" *ngIf="editedAddress.addressType === 'Others'">
              <label for="customAddressType">Other Label</label>
              <input
                type="text"
                id="customAddressType"
                [(ngModel)]="editedAddress.customAddressType"
                class="form-input">
            </div>

            <div class="form-actions">
              <button (click)="saveAddress()" class="btn-save" [disabled]="isSavingAddress">
                <i class="bi bi-check-circle"></i>
                Save Address
              </button>
              <button (click)="cancelAddressEdit()" class="btn-cancel">
                <i class="bi bi-x-circle"></i>
                Cancel
              </button>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-template #profileState>
        <div *ngIf="isLoading" class="profile-state loading">
          <p>Loading profile...</p>
        </div>
        <div *ngIf="!isLoading" class="profile-state empty-state">
          <i class="bi bi-exclamation-circle"></i>
          <p>{{ loadError || 'Unable to load profile.' }}</p>
          <button (click)="retryLoadUser()" class="btn-primary">Retry</button>
        </div>
      </ng-template>
    </div>
  </div>
</div>
